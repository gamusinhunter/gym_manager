{
  "version": 3,
  "sources": ["../../../../../apps/gym_management/gym_management/public/js/profile_page_member.bundle.js"],
  "sourcesContent": ["frappe.provide('frappe.energy_points');\n\nclass ProfilePageMember {\n\tconstructor(wrapper) {\n\t\tthis.wrapper = $(wrapper);\n\t\tthis.page = frappe.ui.make_app_page({\n\t\t\tparent: wrapper,\n\t\t});\n\t\tthis.sidebar = this.wrapper.find('.layout-side-section');\n\t\tthis.main_section = this.wrapper.find('.layout-main-section');\n\t\tthis.wrapper.bind('show', () => {\n\t\t\tthis.show();\n\t\t});\n\t}\n\n\tshow() {\n\t\tlet route = frappe.get_route();\n\t\tthis.user_id = route[1] || frappe.session.user;\n\t\tfrappe.dom.freeze(__('Loading user profile') + '...');\n\t\tfrappe.db.exists('User', this.user_id).then(exists => {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\tif (exists) {\n\t\t\t\tthis.make_user_profile();\n\t\t\t} else {\n\t\t\t\tfrappe.msgprint(__('User does not exist'));\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_user_profile() {\n\t\tthis.user = frappe.user_info(this.user_id);\n\t\tthis.page.set_title(this.user.fullname);\n\t\tthis.setup_user_search();\n\t\tthis.main_section.empty().append(frappe.render_template('user_profile'));\n\t\tthis.energy_points = 0;\n\t\tthis.review_points = 0;\n\t\tthis.rank = 0;\n\t\tthis.month_rank = 0;\n\t\tthis.render_user_details();\n\t\tthis.render_points_and_rank();\n\t\tthis.render_heatmap();\n\t\tthis.render_line_chart();\n\t\tthis.render_percentage_chart('type', 'Type Distribution');\n\t\tthis.create_percentage_chart_filters();\n\t\tthis.setup_user_activity_timeline();\n\t}\n\n\tsetup_user_search() {\n\t\tthis.$user_search_button = this.page.set_secondary_action(\n\t\t\t__('Change User'),\n\t\t\t() => this.show_user_search_dialog(),\n\t\t\t{ icon: 'change', size: 'sm' }\n\t\t);\n\t}\n\n\tshow_user_search_dialog() {\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Change User'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Link',\n\t\t\t\t\tfieldname: 'user',\n\t\t\t\t\toptions: 'User',\n\t\t\t\t\tlabel: __('User'),\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Go'),\n\t\t\tprimary_action: ({ user }) => {\n\t\t\t\tdialog.hide();\n\t\t\t\tfrappe.set_route('user-profile', user);\n\t\t\t}\n\t\t});\n\t\tdialog.show();\n\t}\n\n\trender_heatmap() {\n\t\tthis.heatmap = new frappe.Chart('.performance-heatmap', {\n\t\t\ttype: 'heatmap',\n\t\t\tcountLabel: 'Energy Points',\n\t\t\tdata: {},\n\t\t\tdiscreteDomains: 1,\n\t\t\tradius: 3,\n\t\t\theight: 150\n\t\t});\n\t\tthis.update_heatmap_data();\n\t\tthis.create_heatmap_chart_filters();\n\t}\n\n\tupdate_heatmap_data(date_from) {\n\t\tfrappe.xcall('frappe.desk.page.user_profile.user_profile.get_energy_points_heatmap_data', {\n\t\t\tuser: this.user_id,\n\t\t\tdate: date_from || frappe.datetime.year_start(),\n\t\t}).then((r) => {\n\t\t\tthis.heatmap.update({ dataPoints: r });\n\t\t});\n\t}\n\n\n\trender_line_chart() {\n\t\tthis.line_chart_filters = [\n\t\t\t['Energy Point Log', 'user', '=', this.user_id, false],\n\t\t\t['Energy Point Log', 'type', '!=', 'Review', false]\n\t\t];\n\n\t\tthis.line_chart_config = {\n\t\t\ttimespan: 'Last Month',\n\t\t\ttime_interval: 'Daily',\n\t\t\ttype: 'Line',\n\t\t\tvalue_based_on: 'points',\n\t\t\tchart_type: 'Sum',\n\t\t\tdocument_type: 'Energy Point Log',\n\t\t\tname: 'Energy Points',\n\t\t\twidth: 'half',\n\t\t\tbased_on: 'creation'\n\t\t};\n\n\t\tthis.line_chart = new frappe.Chart('.performance-line-chart', {\n\t\t\ttype: 'line',\n\t\t\theight: 200,\n\t\t\tdata: {\n\t\t\t\tlabels: [],\n\t\t\t\tdatasets: [{}]\n\t\t\t},\n\t\t\tcolors: ['purple'],\n\t\t\taxisOptions: {\n\t\t\t\txIsSeries: 1\n\t\t\t}\n\t\t});\n\t\tthis.update_line_chart_data();\n\t\tthis.create_line_chart_filters();\n\t}\n\n\tupdate_line_chart_data() {\n\t\tthis.line_chart_config.filters_json = JSON.stringify(this.line_chart_filters);\n\n\t\tfrappe.xcall('frappe.desk.doctype.dashboard_chart.dashboard_chart.get', {\n\t\t\tchart: this.line_chart_config,\n\t\t\tno_cache: 1,\n\t\t}).then(chart => {\n\t\t\tthis.line_chart.update(chart);\n\t\t});\n\t}\n\n\t// eslint-disable-next-line no-unused-vars\n\trender_percentage_chart(field, title) {\n\t\tfrappe.xcall('frappe.desk.page.user_profile.user_profile.get_energy_points_percentage_chart_data', {\n\t\t\tuser: this.user_id,\n\t\t\tfield: field\n\t\t}).then(chart => {\n\t\t\tif (chart.labels.length) {\n\t\t\t\tthis.percentage_chart = new frappe.Chart('.performance-percentage-chart', {\n\t\t\t\t\ttype: 'percentage',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tlabels: chart.labels,\n\t\t\t\t\t\tdatasets: chart.datasets\n\t\t\t\t\t},\n\t\t\t\t\ttruncateLegends: 1,\n\t\t\t\t\tbarOptions: {\n\t\t\t\t\t\theight: 11,\n\t\t\t\t\t\tdepth: 1\n\t\t\t\t\t},\n\t\t\t\t\theight: 200,\n\t\t\t\t\tmaxSlices: 8,\n\t\t\t\t\tcolors: ['purple', 'blue', 'cyan', 'teal', 'pink', 'red', 'orange', 'yellow'],\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.wrapper.find('.percentage-chart-container').hide();\n\t\t\t}\n\t\t});\n\t}\n\n\tcreate_line_chart_filters() {\n\t\tlet filters = [\n\t\t\t{\n\t\t\t\tlabel: 'All',\n\t\t\t\toptions: ['All', 'Auto', 'Criticism', 'Appreciation', 'Revert'],\n\t\t\t\taction: (selected_item) => {\n\t\t\t\t\tif (selected_item === 'All') {\n\t\t\t\t\t\tthis.line_chart_filters = [\n\t\t\t\t\t\t\t['Energy Point Log', 'user', '=', this.user_id, false],\n\t\t\t\t\t\t\t['Energy Point Log', 'type', '!=', 'Review', false]\n\t\t\t\t\t\t];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.line_chart_filters[1] = ['Energy Point Log', 'type', '=', selected_item, false];\n\t\t\t\t\t}\n\t\t\t\t\tthis.update_line_chart_data();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: 'Last Month',\n\t\t\t\toptions: ['Last Week', 'Last Month', 'Last Quarter', 'Last Year'],\n\t\t\t\taction: (selected_item) => {\n\t\t\t\t\tthis.line_chart_config.timespan = selected_item;\n\t\t\t\t\tthis.update_line_chart_data();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tlabel: 'Daily',\n\t\t\t\toptions: ['Daily', 'Weekly', 'Monthly'],\n\t\t\t\taction: (selected_item) => {\n\t\t\t\t\tthis.line_chart_config.time_interval = selected_item;\n\t\t\t\t\tthis.update_line_chart_data();\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\t\tfrappe.dashboard_utils.render_chart_filters(filters, 'chart-filter', '.line-chart-options', 1);\n\t}\n\n\tcreate_percentage_chart_filters() {\n\t\tlet filters = [\n\t\t\t{\n\t\t\t\tlabel: 'Type',\n\t\t\t\toptions: ['Type', 'Reference Doctype', 'Rule'],\n\t\t\t\tfieldnames: ['type', 'reference_doctype', 'rule'],\n\t\t\t\taction: (selected_item, fieldname) => {\n\t\t\t\t\tlet title = selected_item + ' Distribution';\n\t\t\t\t\tthis.render_percentage_chart(fieldname, title);\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\t\tfrappe.dashboard_utils.render_chart_filters(filters, 'chart-filter', '.percentage-chart-options');\n\t}\n\n\tcreate_heatmap_chart_filters() {\n\t\tlet filters = [\n\t\t\t{\n\t\t\t\tlabel: frappe.dashboard_utils.get_year(frappe.datetime.now_date()),\n\t\t\t\toptions: frappe.dashboard_utils.get_years_since_creation(frappe.boot.user.creation),\n\t\t\t\taction: (selected_item) => {\n\t\t\t\t\tthis.update_heatmap_data(frappe.datetime.obj_to_str(selected_item));\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\t\tfrappe.dashboard_utils.render_chart_filters(filters, 'chart-filter', '.heatmap-options');\n\t}\n\n\n\tedit_profile() {\n\t\tlet edit_profile_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Edit Profile'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Attach Image',\n\t\t\t\t\tfieldname: 'user_image',\n\t\t\t\t\tlabel: 'Profile Image',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tfieldname: 'interest',\n\t\t\t\t\tlabel: 'Interests',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Column Break'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\tfieldname: 'location',\n\t\t\t\t\tlabel: 'Location',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Section Break',\n\t\t\t\t\tfieldname: 'Interest',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'Small Text',\n\t\t\t\t\tfieldname: 'bio',\n\t\t\t\t\tlabel: 'Bio',\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action: values => {\n\t\t\t\tedit_profile_dialog.disable_primary_action();\n\t\t\t\tfrappe.xcall('frappe.desk.page.user_profile.user_profile.update_profile_info', {\n\t\t\t\t\tprofile_info: values\n\t\t\t\t}).then(user => {\n\t\t\t\t\tuser.image = user.user_image;\n\t\t\t\t\tthis.user = Object.assign(values, user);\n\t\t\t\t\tedit_profile_dialog.hide();\n\t\t\t\t\tthis.render_user_details();\n\t\t\t\t}).finally(() => {\n\t\t\t\t\tedit_profile_dialog.enable_primary_action();\n\t\t\t\t});\n\t\t\t},\n\t\t\tprimary_action_label: __('Save')\n\t\t});\n\n\t\tedit_profile_dialog.set_values({\n\t\t\tuser_image: this.user.image,\n\t\t\tlocation: this.user.location,\n\t\t\tinterest: this.user.interest,\n\t\t\tbio: this.user.bio\n\t\t});\n\t\tedit_profile_dialog.show();\n\t}\n\n\trender_user_details() {\n\t\tthis.sidebar.empty().append(frappe.render_template('user_profile_sidebar', {\n\t\t\tuser_image: this.user.image,\n\t\t\tuser_abbr: this.user.abbr,\n\t\t\tuser_location: this.user.location,\n\t\t\tuser_interest: this.user.interest,\n\t\t\tuser_bio: this.user.bio,\n\t\t}));\n\n\t\tthis.setup_user_profile_links();\n\t}\n\n\tsetup_user_profile_links() {\n\t\tif (this.user_id !== frappe.session.user) {\n\t\t\tthis.wrapper.find('.profile-links').hide();\n\t\t} else {\n\t\t\tthis.wrapper.find('.edit-profile-link').on('click', () => {\n\t\t\t\tthis.edit_profile();\n\t\t\t});\n\n\t\t\tthis.wrapper.find('.user-settings-link').on('click', () => {\n\t\t\t\tthis.go_to_user_settings();\n\t\t\t});\n\t\t}\n\t}\n\n\tget_user_rank() {\n\t\treturn frappe.xcall('frappe.desk.page.user_profile.user_profile.get_user_rank', {\n\t\t\tuser: this.user_id,\n\t\t}).then(r => {\n\t\t\tif (r.monthly_rank.length) this.month_rank = r.monthly_rank[0];\n\t\t\tif (r.all_time_rank.length) this.rank = r.all_time_rank[0];\n\t\t});\n\t}\n\n\tget_user_points() {\n\t\treturn frappe.xcall(\n\t\t\t'frappe.social.doctype.energy_point_log.energy_point_log.get_user_energy_and_review_points',\n\t\t\t{\n\t\t\t\tuser: this.user_id,\n\t\t\t}\n\t\t).then(r => {\n\t\t\tif (r[this.user_id]) {\n\t\t\t\tthis.energy_points = r[this.user_id].energy_points;\n\t\t\t\tthis.review_points = r[this.user_id].review_points;\n\t\t\t}\n\t\t});\n\t}\n\n\trender_points_and_rank() {\n\t\tlet $profile_details = this.wrapper.find('.user-stats');\n\t\tlet $profile_details_wrapper = this.wrapper.find('.user-stats-detail');\n\n\t\tconst _get_stat_dom = (value, label, icon) => {\n\t\t\treturn `<div class=\"user-stats-item mt-4\">\n\t\t\t\t${frappe.utils.icon(icon, \"lg\", \"no-stroke\")}\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"stat-value\">${value}</div>\n\t\t\t\t\t<div class=\"stat-label\">${label}</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t};\n\n\t\tthis.get_user_rank().then(() => {\n\t\t\tthis.get_user_points().then(() => {\n\t\t\t\tlet html = $(`\n\t\t\t\t\t${_get_stat_dom(this.energy_points, __('Energy Points'), \"color-energy-points\")}\n\t\t\t\t\t${_get_stat_dom(this.review_points, __('Review Points'), \"color-review-points\")}\n\t\t\t\t\t${_get_stat_dom(this.rank, __('Rank'), \"color-rank\")}\n\t\t\t\t\t${_get_stat_dom(this.month_rank, __('Monthly Rank'), \"color-monthly-rank\")}\n\t\t\t\t`);\n\n\t\t\t\t$profile_details.append(html);\n\t\t\t\t$profile_details_wrapper.removeClass(\"hide\");\n\t\t\t});\n\t\t});\n\t}\n\n\tgo_to_user_settings() {\n\t\tfrappe.set_route('Form', 'User', this.user_id);\n\t}\n\n\tsetup_user_activity_timeline() {\n\t\tthis.user_activity_timeline = new UserProfileTimeline({\n\t\t\tparent: this.wrapper.find('.recent-activity-list'),\n\t\t\tfooter: this.wrapper.find('.recent-activity-footer'),\n\t\t\tuser: this.user_id\n\t\t});\n\n\t\tthis.user_activity_timeline.refresh();\n\t}\n}\n\nfrappe.provide('frappe.ui');\nfrappe.ui.UserProfile = UserProfile;\n"],
  "mappings": ";;AAAA,SAAO,QAAQ,sBAAsB;AAmYrC,SAAO,QAAQ,WAAW;AAC1B,SAAO,GAAG,cAAc;",
  "names": []
}
